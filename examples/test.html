<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ScreenGrid Library - Simple Test</title>
    <script src="https://unpkg.com/maplibre-gl@4.0.0/dist/maplibre-gl.js"></script>
    <link href="https://unpkg.com/maplibre-gl@4.0.0/dist/maplibre-gl.css" rel="stylesheet" />
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
        }
        #map {
            width: 100%;
            height: 500px;
            border: 1px solid #ccc;
        }
        .info {
            margin-top: 10px;
            padding: 10px;
            background: #f5f5f5;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <h1>ScreenGrid Library Test</h1>
    <div id="map"></div>
    <div class="info">
        <p><strong>Test Status:</strong> <span id="status">Loading...</span></p>
        <p><strong>Data Points:</strong> <span id="pointCount">-</span></p>
        <p><strong>Instructions:</strong> Hover over the grid cells to see values, click for alerts.</p>
    </div>

    <script type="module">
        import { ScreenGridLayerGL } from '../src/index.js';
        
        const statusEl = document.getElementById('status');
        const pointCountEl = document.getElementById('pointCount');
        
        // Test data - some points around San Francisco
        const testData = [
            { coordinates: [-122.4, 37.74], weight: 5 },
            { coordinates: [-122.41, 37.75], weight: 3 },
            { coordinates: [-122.39, 37.73], weight: 8 },
            { coordinates: [-122.42, 37.76], weight: 2 },
            { coordinates: [-122.38, 37.72], weight: 6 },
            { coordinates: [-122.43, 37.77], weight: 4 },
            { coordinates: [-122.37, 37.71], weight: 7 },
            { coordinates: [-122.44, 37.78], weight: 1 },
            { coordinates: [-122.36, 37.70], weight: 9 },
            { coordinates: [-122.45, 37.79], weight: 3 }
        ];
        
        // Initialize map
        const map = new maplibregl.Map({
            container: 'map',
            style: 'https://demotiles.maplibre.org/style.json',
            center: [-122.4, 37.74],
            zoom: 12
        });
        
        map.on('load', () => {
            try {
                statusEl.textContent = 'Creating grid layer...';
                pointCountEl.textContent = testData.length;
                
                // Create grid layer
                const gridLayer = new ScreenGridLayerGL({
                    data: testData,
                    getPosition: (d) => d.coordinates,
                    getWeight: (d) => d.weight,
                    cellSizePixels: 50,
                    colorScale: (v) => [255 * v, 200 * (1 - v), 50, 200],
                    onAggregate: (grid) => {
                        console.log('Grid aggregated:', grid);
                        statusEl.textContent = 'Grid layer active - hover over cells!';
                    },
                    onHover: ({ cell }) => {
                        console.log('Hovered cell:', cell);
                    },
                    onClick: ({ cell }) => {
                        alert(`Clicked cell (${cell.col}, ${cell.row})\nValue: ${cell.value}`);
                    }
                });
                
                // Add layer to map
                map.addLayer(gridLayer);
                
                statusEl.textContent = 'Grid layer active - hover over cells!';
                
            } catch (error) {
                console.error('Error:', error);
                statusEl.textContent = `Error: ${error.message}`;
            }
        });
        
        map.on('error', (e) => {
            console.error('Map error:', e);
            statusEl.textContent = `Map error: ${e.error.message}`;
        });
    </script>
</body>
</html>
